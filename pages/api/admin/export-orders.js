export default async function handler(req,res){try{const {createClient}=await import('@supabase/supabase-js');const s=createClient(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);const {data,error}=await s.from('orders').select('id,brand_slug,subtotal,ship_cost,total,pay,shipping,created_at');if(error)return res.status(500).send(error.message);const rows=data||[];const csv=['id,brand_slug,subtotal,ship_cost,total,pay,shipping,created_at'].concat(rows.map(r=>[r.id,r.brand_slug,r.subtotal,r.ship_cost,r.total,r.pay,r.shipping,r.created_at].join(','))).join('\n');res.setHeader('Content-Type','text/csv; charset=utf-8');res.setHeader('Content-Disposition','attachment; filename="orders.csv"');return res.status(200).send(csv)}catch(e){return res.status(500).send(e.message)}}
