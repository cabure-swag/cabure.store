import { useEffect,useState } from 'react';import { supabase } from '../../lib/supabaseClient';export default function Perfil(){const [user,setUser]=useState(null);const [avatar,setAvatar]=useState('');useEffect(()=>{(async()=>{const {data:s}=await supabase.auth.getSession();const u=s?.session?.user||null;setUser(u);if(u){const {data:prof}=await supabase.from('profiles').select('avatar_url').eq('id',u.id).single();setAvatar(prof?.avatar_url||u.user_metadata?.picture||'')}})()},[]);async function onSave(e){e.preventDefault();const f=new FormData(e.currentTarget);const file=f.get('avatar');let url=avatar||null;if(file&&file.size>0){const path=`avatars/${user.id}/${Date.now()}_${file.name}`;const {error:e1}=await supabase.storage.from('media').upload(path,file,{upsert:true});if(e1)return alert(e1.message);const {data:pub}=await supabase.storage.from('media').getPublicUrl(path);url=pub?.publicUrl||null}const {error}=await supabase.from('profiles').update({avatar_url:url}).eq('id',user.id);if(error)return alert(error.message);alert('Perfil actualizado');window.location.reload();}if(!user)return <main className='container'><p className='small'>Iniciá sesión.</p></main>;return(<main className='container'><h1 className='h1'>Mi perfil</h1><div className='card'><form onSubmit={onSave} className='grid' style={{gridTemplateColumns:'1fr 1fr'}}><div><label>Avatar (archivo)</label><input className='input' name='avatar' type='file' accept='image/*'/></div><div><label>Avatar actual</label>{avatar?<img src={avatar} alt='avatar' className='avatar' style={{width:64,height:64}}/>:<span className='small'>Sin avatar</span>}</div><div style={{gridColumn:'1/-1'}}><button className='btn'>Guardar</button></div></form></div></main>)}
