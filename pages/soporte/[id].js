import { useRouter } from 'next/router';import { useEffect,useState } from 'react';import { supabase } from '../../lib/supabaseClient';
export default function Ticket(){const router=useRouter();const { id }=router.query;const [ticket,setTicket]=useState(null);const [msgs,setMsgs]=useState([]);
useEffect(()=>{if(!id)return;(async()=>{const {data:t}=await supabase.from('support_tickets').select('*').eq('id',id).single();setTicket(t||null);const {data:m}=await supabase.from('support_messages').select('*').eq('ticket_id',id).order('created_at',{ascending:true});setMsgs(m||[])})()},[id]);
async function send(e){e.preventDefault();const f=new FormData(e.currentTarget);const message=f.get('message');const {error}=await supabase.from('support_messages').insert({ticket_id:id,message,from_admin:false});if(error)return alert(error.message);e.currentTarget.reset();const {data:m}=await supabase.from('support_messages').select('*').eq('ticket_id',id).order('created_at',{ascending:true});setMsgs(m||[]);}
if(!ticket)return(<main className='container'><p className='small'>Cargando…</p></main>);
return(<main className='container'><h1 className='h1'>{ticket.subject}</h1><div className='card'>{msgs.map((m,i)=>(<div key={i} className='small' style={{marginBottom:8}}><strong>{m.from_admin?'Soporte':'Vos'}:</strong> {m.message}</div>))}<form onSubmit={send} className='row' style={{marginTop:12}}><input className='input' name='message' placeholder='Escribí un mensaje…' required/><button className='btn'>Enviar</button></form></div></main>)}
